/home/lcur2470/.conda/envs/rs/lib/python3.8/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
args: Namespace(act_func='tanh', anneal_cap=0.005, anneal_steps=500, batch_size=400, cuda=True, data_path='./datasets/', dataset='yelp_clean', emb_path='./datasets/', emb_size=10, epochs=1000, gpu='1', in_dims='[300]', lamda=0.03, log_name='log', lr1=0.0001, lr2=0.0001, mean_type='x0', mlp_act_func='tanh', mlp_dims='[300]', n_cate=2, noise_max=0.02, noise_min=0.0001, noise_scale=0.1, noise_schedule='linear-var', norm=False, num_workers=4, optimizer1='AdamW', optimizer2='AdamW', out_dims='[]', reparam=True, reweight=True, round=1, sampling_noise=False, sampling_steps=0, save_path='./saved_models/', steps=100, time_type='cat', topN='[10, 20, 50, 100]', tst_w_val=False, vae_anneal_cap=0.3, vae_anneal_steps=200, wd1=0.0, wd2=0.0)
Starting time:  2023-06-14 16:12:21
user num: 54574
item num: 34395
data ready.
emb_path: ./datasets/yelp_clean/item_emb.npy
running k-means on cuda:0..
[running kmeans]: 0it [00:00, ?it/s][running kmeans]: 0it [00:00, ?it/s, center_shift=1.497784, iteration=1, tol=0.000100][running kmeans]: 1it [00:00, 18.11it/s, center_shift=0.052342, iteration=2, tol=0.000100][running kmeans]: 2it [00:00, 32.22it/s, center_shift=0.005688, iteration=3, tol=0.000100][running kmeans]: 3it [00:00, 43.38it/s, center_shift=0.001718, iteration=4, tol=0.000100][running kmeans]: 4it [00:00, 52.37it/s, center_shift=0.000599, iteration=5, tol=0.000100][running kmeans]: 5it [00:00, 59.93it/s, center_shift=0.000544, iteration=6, tol=0.000100][running kmeans]: 6it [00:00, 65.88it/s, center_shift=0.000382, iteration=7, tol=0.000100][running kmeans]: 7it [00:00, 71.48it/s, center_shift=0.000154, iteration=8, tol=0.000100][running kmeans]: 8it [00:00, 76.90it/s, center_shift=0.000106, iteration=9, tol=0.000100][running kmeans]: 9it [00:00, 86.43it/s, center_shift=0.000106, iteration=9, tol=0.000100][running kmeans]: 9it [00:00, 86.43it/s, center_shift=0.000092, iteration=10, tol=0.000100][running kmeans]: 10it [00:00, 90.69it/s, center_shift=0.000092, iteration=10, tol=0.000100]category length:  [32517, 1878]
Latent dims of each category:  [[283], [17]]
Number of parameters: 29005679
models ready.
Preparing mask for validation & test costs 00: 00: 00
Start training...

Runing Epoch 001 train loss 32340.8967 costs 00: 00: 09
------------------------------------------------------
Runing Epoch 002 train loss 31150.6433 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 003 train loss 30127.9237 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 004 train loss 29239.0645 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0028
0.0024
0.0019
0.0016 
Recall:
 0.0073
0.0124
0.0243
0.0395 
NDCG:
 0.0053
0.007
0.0103
0.0139 
MRR:
 0.0088
0.0101
0.0113
0.0119
[Test]:  
Precision:
 0.0017
0.0015
0.0013
0.001 
Recall:
 0.0078
0.0137
0.0274
0.0445 
NDCG:
 0.0046
0.0064
0.0098
0.0132 
MRR:
0.0056
0.0065
0.0073
0.0078
Runing Epoch 005 train loss 28689.0254 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 006 train loss 28359.5427 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 007 train loss 28163.1080 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 008 train loss 27926.2334 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 009 train loss 27645.9524 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0013
0.0011
0.0009
0.0008 
Recall:
 0.0028
0.0051
0.0101
0.0177 
NDCG:
 0.0021
0.0028
0.0043
0.0061 
MRR:
 0.0034
0.0038
0.0043
0.0046
[Test]:  
Precision:
 0.0009
0.0008
0.0006
0.0005 
Recall:
 0.0034
0.0058
0.0116
0.0201 
NDCG:
 0.002
0.0027
0.0042
0.0059 
MRR:
0.0024
0.0027
0.0031
0.0033
Runing Epoch 010 train loss 27327.0756 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 011 train loss 26993.9437 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 012 train loss 26641.9828 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 013 train loss 26230.9557 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 014 train loss 25918.0914 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0062
0.0056
0.0048
0.004 
Recall:
 0.0134
0.0246
0.0524
0.0863 
NDCG:
 0.0101
0.0139
0.0219
0.0303 
MRR:
 0.0175
0.0201
0.0226
0.0237
[Test]:  
Precision:
 0.0043
0.004
0.0034
0.0028 
Recall:
 0.0159
0.0291
0.0616
0.1025 
NDCG:
 0.0099
0.014
0.0222
0.0307 
MRR:
0.0131
0.0151
0.0171
0.0181
Runing Epoch 015 train loss 25670.6192 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 016 train loss 25482.5209 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 017 train loss 25284.0324 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 018 train loss 25116.7841 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 019 train loss 25004.3790 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0064
0.0059
0.0051
0.0044 
Recall:
 0.014
0.0257
0.0554
0.0958 
NDCG:
 0.0105
0.0144
0.023
0.0329 
MRR:
 0.018
0.0209
0.0235
0.0248
[Test]:  
Precision:
 0.0046
0.0042
0.0036
0.0031 
Recall:
 0.0168
0.0308
0.0663
0.1137 
NDCG:
 0.0103
0.0147
0.0235
0.0334 
MRR:
0.0138
0.016
0.0182
0.0193
Runing Epoch 020 train loss 24851.7011 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 021 train loss 24737.0208 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 022 train loss 24634.6181 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 023 train loss 24519.1341 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 024 train loss 24421.8149 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0069
0.0063
0.0052
0.0045 
Recall:
 0.0159
0.0287
0.0587
0.0998 
NDCG:
 0.0123
0.0166
0.0252
0.0352 
MRR:
 0.0217
0.0245
0.0272
0.0285
[Test]:  
Precision:
 0.005
0.0045
0.0038
0.0032 
Recall:
 0.0192
0.0349
0.0711
0.1188 
NDCG:
 0.0122
0.017
0.026
0.0359 
MRR:
0.0163
0.0186
0.0208
0.0219
Runing Epoch 025 train loss 24346.7056 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 026 train loss 24262.9755 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 027 train loss 24169.2925 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 028 train loss 24109.1066 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 029 train loss 24045.4499 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0072
0.0065
0.0056
0.0047 
Recall:
 0.0167
0.0299
0.0628
0.1061 
NDCG:
 0.0129
0.0173
0.0268
0.0372 
MRR:
 0.0225
0.0254
0.0282
0.0296
[Test]:  
Precision:
 0.0053
0.0047
0.004
0.0033 
Recall:
 0.0208
0.0366
0.0753
0.1253 
NDCG:
 0.0129
0.0177
0.0274
0.0377 
MRR:
0.0168
0.0191
0.0214
0.0225
Runing Epoch 030 train loss 23975.9918 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 031 train loss 23943.6968 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 032 train loss 23849.8088 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 033 train loss 23804.8098 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 034 train loss 23749.9989 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0076
0.0068
0.0056
0.0047 
Recall:
 0.0178
0.0311
0.0638
0.1073 
NDCG:
 0.0137
0.0181
0.0275
0.038 
MRR:
 0.0238
0.0268
0.0295
0.0308
[Test]:  
Precision:
 0.0055
0.0049
0.004
0.0033 
Recall:
 0.0215
0.0378
0.076
0.1262 
NDCG:
 0.0134
0.0184
0.0279
0.0383 
MRR:
0.0175
0.0199
0.0222
0.0233
Runing Epoch 035 train loss 23728.1254 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 036 train loss 23651.3947 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 037 train loss 23622.4956 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 038 train loss 23579.5528 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 039 train loss 23510.9208 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0075
0.0068
0.0057
0.0049 
Recall:
 0.0174
0.0314
0.066
0.1118 
NDCG:
 0.0131
0.0178
0.0277
0.0387 
MRR:
 0.0224
0.0255
0.0284
0.0298
[Test]:  
Precision:
 0.0055
0.0049
0.0041
0.0034 
Recall:
 0.0214
0.038
0.0798
0.1315 
NDCG:
 0.013
0.0181
0.0284
0.039 
MRR:
0.0167
0.0192
0.0216
0.0228
Runing Epoch 040 train loss 23477.0527 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 041 train loss 23440.7606 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 042 train loss 23411.2304 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 043 train loss 23352.7878 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 044 train loss 23333.0493 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0077
0.007
0.0059
0.0051 
Recall:
 0.018
0.0326
0.0683
0.1181 
NDCG:
 0.0134
0.0183
0.0285
0.0404 
MRR:
 0.0228
0.026
0.029
0.0305
[Test]:  
Precision:
 0.0057
0.005
0.0042
0.0036 
Recall:
 0.0222
0.0396
0.0821
0.1371 
NDCG:
 0.0135
0.0189
0.0295
0.0408 
MRR:
0.0177
0.0202
0.0227
0.024
Runing Epoch 045 train loss 23288.6437 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 046 train loss 23242.3311 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 047 train loss 23201.7860 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 048 train loss 23158.8565 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 049 train loss 23119.7585 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.008
0.0072
0.006
0.0052 
Recall:
 0.0189
0.0339
0.0705
0.1215 
NDCG:
 0.0141
0.0191
0.0296
0.0418 
MRR:
 0.0238
0.027
0.0301
0.0316
[Test]:  
Precision:
 0.0058
0.0052
0.0043
0.0036 
Recall:
 0.0231
0.0411
0.0848
0.1416 
NDCG:
 0.0142
0.0197
0.0306
0.0422 
MRR:
0.0186
0.0212
0.0238
0.0251
Runing Epoch 050 train loss 23128.6779 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 051 train loss 23055.8607 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 052 train loss 23042.3628 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 053 train loss 23005.9660 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 054 train loss 22984.8338 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0083
0.0075
0.0063
0.0054 
Recall:
 0.0196
0.0356
0.0746
0.1271 
NDCG:
 0.0147
0.02
0.0311
0.0436 
MRR:
 0.025
0.0284
0.0316
0.0331
[Test]:  
Precision:
 0.006
0.0054
0.0045
0.0038 
Recall:
 0.0237
0.042
0.088
0.1467 
NDCG:
 0.0147
0.0204
0.0317
0.0437 
MRR:
0.0194
0.0221
0.0247
0.026
Runing Epoch 055 train loss 22949.6223 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 056 train loss 22928.4739 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 057 train loss 22890.4160 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 058 train loss 22880.4363 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 059 train loss 22829.4480 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0085
0.0076
0.0064
0.0055 
Recall:
 0.0204
0.0365
0.0765
0.1305 
NDCG:
 0.0153
0.0207
0.0321
0.0449 
MRR:
 0.026
0.0294
0.0327
0.0343
[Test]:  
Precision:
 0.0062
0.0056
0.0046
0.0038 
Recall:
 0.0246
0.0446
0.0911
0.1511 
NDCG:
 0.0151
0.0213
0.0327
0.045 
MRR:
0.0197
0.0225
0.0252
0.0266
Runing Epoch 060 train loss 22815.9558 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 061 train loss 22806.6298 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 062 train loss 22768.3146 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 063 train loss 22747.2628 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 064 train loss 22720.1560 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0085
0.0076
0.0065
0.0055 
Recall:
 0.0205
0.0369
0.0781
0.1315 
NDCG:
 0.0156
0.021
0.0327
0.0454 
MRR:
 0.0265
0.03
0.0333
0.0349
[Test]:  
Precision:
 0.0062
0.0056
0.0046
0.0039 
Recall:
 0.0247
0.0452
0.0922
0.153 
NDCG:
 0.0152
0.0215
0.033
0.0454 
MRR:
0.0197
0.0226
0.0252
0.0266
Runing Epoch 065 train loss 22717.9322 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 066 train loss 22672.8316 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 067 train loss 22641.4719 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 068 train loss 22638.8616 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 069 train loss 22617.0335 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0082
0.0076
0.0064
0.0055 
Recall:
 0.02
0.0368
0.0776
0.1317 
NDCG:
 0.0152
0.0208
0.0324
0.0452 
MRR:
 0.0259
0.0295
0.0328
0.0343
[Test]:  
Precision:
 0.0061
0.0056
0.0046
0.0039 
Recall:
 0.0244
0.0446
0.093
0.1549 
NDCG:
 0.0153
0.0214
0.0333
0.0459 
MRR:
0.0199
0.0228
0.0255
0.0269
Runing Epoch 070 train loss 22584.3150 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 071 train loss 22574.8065 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 072 train loss 22549.4707 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 073 train loss 22515.9084 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 074 train loss 22493.0592 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0082
0.0075
0.0063
0.0054 
Recall:
 0.02
0.0365
0.0771
0.1312 
NDCG:
 0.0149
0.0204
0.0319
0.0447 
MRR:
 0.0251
0.0285
0.0318
0.0334
[Test]:  
Precision:
 0.006
0.0055
0.0046
0.0038 
Recall:
 0.0242
0.0444
0.092
0.1533 
NDCG:
 0.0148
0.0211
0.0327
0.0452 
MRR:
0.019
0.0219
0.0246
0.026
Runing Epoch 075 train loss 22485.2853 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 076 train loss 22481.1041 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 077 train loss 22452.8610 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 078 train loss 22416.6710 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 079 train loss 22418.3967 costs 00: 00: 08
------------------------------------------------------
[Valid]: 
Precision:
 0.0082
0.0074
0.0063
0.0054 
Recall:
 0.0202
0.0368
0.0776
0.1328 
NDCG:
 0.015
0.0206
0.0321
0.0451 
MRR:
 0.025
0.0285
0.0319
0.0335
[Test]:  
Precision:
 0.006
0.0055
0.0046
0.0039 
Recall:
 0.0245
0.0444
0.0944
0.1563 
NDCG:
 0.015
0.0211
0.0334
0.0459 
MRR:
0.0193
0.0221
0.0249
0.0263
Runing Epoch 080 train loss 22403.8444 costs 00: 00: 52
------------------------------------------------------
Runing Epoch 081 train loss 22390.9932 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 082 train loss 22355.5019 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 083 train loss 22330.6608 costs 00: 00: 08
------------------------------------------------------
Runing Epoch 084 train loss 22332.7813 costs 00: 00: 08
------------------------------------------------------
------------------
Exiting from training early
======================================================
End. Best Epoch 065 
[Valid]: 
Precision:
 0.0085
0.0076
0.0065
0.0055 
Recall:
 0.0205
0.0369
0.0781
0.1315 
NDCG:
 0.0156
0.021
0.0327
0.0454 
MRR:
 0.0265
0.03
0.0333
0.0349
[Test]:  
Precision:
 0.0062
0.0056
0.0046
0.0039 
Recall:
 0.0247
0.0452
0.0922
0.153 
NDCG:
 0.0152
0.0215
0.033
0.0454 
MRR:
0.0197
0.0226
0.0252
0.0266
End time:  2023-06-14 16:35:37
